{
  "markdown_tools": {
    "markdown_outline": {
      "type": "function",
      "function": {
        "name": "markdown_outline",
        "description": "Get a table of contents for a Markdown document. Call this first on unfamiliar docs to see full section structure with minimal tokens. Use format='text' (default) for a compact TOC; use format='json' to get selectors you can pass directly to other tools.\n\nSelector guidance: Prefer copying selectors returned by markdown_outline(format='json') rather than writing them by hand.\n\nExamples (basic â†’ advanced):\n1) Section by heading:\n   - \"## [Installation]\"\n2) Node under a section with an attribute filter:\n   - \"## [Setup] > code[language=\\\"bash\\\"]\"\n3) Positional list item under a section:\n   - \"## [Tasks] > ul > li:2\"\n4) Task-items filtered by status:\n   - \"## [Sprint Backlog] > task-item[status=\\\"\\\"]\"\n\nNotes: Section title matching is case-insensitive. Aliases: list/ul|ol, list-item/li, language/lang. Index with :n. Not supported: :has(...), :nth-of-type(...).",
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "markdown": {
              "type": "string",
              "description": "The Markdown document to outline."
            },
            "depth": {
              "type": "integer",
              "minimum": 1,
              "maximum": 6,
              "description": "Deepest heading level to include. Use 2 for a high-level overview, 6 (default) for the full structure."
            },
            "format": {
              "type": "string",
              "enum": ["text", "json"],
              "description": "text (default): compact indented TOC. json: structured TOC with selectors per section for programmatic selection in markdown_read/markdown_edit."
            }
          },
          "required": ["markdown"]
        }
      }
    },
    "markdown_read": {
      "type": "function",
      "function": {
        "name": "markdown_read",
        "description": "Read a specific section/block or the entire document. Use this to inspect content before editing, verify a section exists, or export the final document. Pass selector to read one section; omit selector or pass '*' for the whole document. If selector targets a Section, output includes the header and all owned child content.\n\nSelector must follow MDOM selector syntax; prefer selectors from markdown_outline(format='json') or markdown_find.",
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "markdown": {
              "type": "string",
              "description": "The Markdown document to read from."
            },
            "selector": {
              "type": "string",
              "description": "MDOM selector targeting a section or node (e.g. ## [Installation], ## [Tasks] > list > list-item:2, ## Setup > code[language='bash']). Omit or pass '*' for whole document. Aliases: list/ul|ol, list-item/li, language/lang. Index with :n. Not supported: :has, :nth-of-type."
            },
            "all": {
              "type": "boolean",
              "description": "If true, return every node matching selector. Default false returns the first match."
            },
            "format": {
              "type": "string",
              "enum": ["markdown", "json"],
              "description": "markdown (default): rendered Markdown. json: node metadata (type, level, headerText) plus content."
            },
            "maxTokens": {
              "type": "integer",
              "minimum": 1,
              "description": "Stop after approximately this many tokens; includes a truncation notice."
            }
          },
          "required": ["markdown"]
        }
      }
    },
    "markdown_find": {
      "type": "function",
      "function": {
        "name": "markdown_find",
        "description": "Find a section or block using a plain-English query when you don't know exact heading text. Returns ranked candidates with selectors and confidence scores. Use when you're unsure of wording (e.g. 'the section about authentication'). Scores >0.90 are typically safe; <0.75 suggests calling markdown_outline first. Returned selectors are MDOM selectors (not CSS) and can be passed directly to markdown_read/markdown_edit/markdown_tasks.",
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "markdown": {
              "type": "string",
              "description": "The Markdown document to search."
            },
            "query": {
              "type": "string",
              "description": "Plain-English description of what you're looking for (e.g. 'the rate limiting section', 'the JavaScript installation example', 'the section about error codes')."
            },
            "blockType": {
              "type": "string",
              "enum": ["section", "code", "list", "task-item", "table", "blockquote", "heading"],
              "description": "Restrict matches to a node type. Omit to search all node types."
            },
            "within": {
              "type": "string",
              "description": "MDOM selector of a section to search within (e.g. ## [API Reference]). Omit to search whole document. Aliases: list/ul|ol, list-item/li, language/lang."
            },
            "limit": {
              "type": "integer",
              "minimum": 1,
              "description": "Max candidates to return. Default 3."
            }
          },
          "required": ["markdown", "query"]
        }
      }
    },
    "markdown_edit": {
      "type": "function",
      "function": {
        "name": "markdown_edit",
        "description": "Apply one or more edits to a Markdown document in a single atomic call. Batch changes into one call to avoid intermediate state issues. Ops apply in order; by default, failure rolls back the whole batch. Ops: replace (update section header/body), insert (add Markdown before/after/inside a node), remove (delete node + children), move (relocate node relative to target), substitute (scoped find/replace within a node).\n\nSelector must follow MDOM syntax; prefer selectors from markdown_outline(format='json') or markdown_find.",
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "markdown": {
              "type": "string",
              "description": "The Markdown document to edit."
            },
            "ops": {
              "type": "array",
              "description": "Ordered list of edit operations. Each op has 'op' plus op-specific fields. Later ops see the result of earlier ones. Prefer semantic selectors (e.g. ## [Section Name]) over positional selectors to reduce drift.",
              "items": {
                "type": "object",
                "required": ["op", "selector"],
                "properties": {
                  "op": {
                    "type": "string",
                    "enum": ["replace", "insert", "remove", "move", "substitute"],
                    "description": "replace: update a section header/body. insert: add Markdown relative to selector. remove: delete node + children. move: relocate node relative to target. substitute: scoped find/replace within selector."
                  },
                  "selector": {
                    "type": "string",
                    "description": "MDOM selector of the node to change/remove/move (for move, this is the source). Examples: ## [Installation], ## API > code[language='js'], ## [Plan] > list-item:2. Aliases: list/ul|ol, list-item/li, language/lang. Index with :n. Not supported: :has, :nth-of-type."
                  },
                  "header": {
                    "type": "string",
                    "description": "replace only: new header text (heading level preserved)."
                  },
                  "content": {
                    "type": "string",
                    "description": "replace only: new body Markdown (replaces all children of the section)."
                  },
                  "where": {
                    "type": "string",
                    "enum": ["before", "after", "first-child", "last-child"],
                    "description": "insert: where to place new Markdown relative to selector. move: where to place moved node relative to target."
                  },
                  "markdown": {
                    "type": "string",
                    "description": "insert only: Markdown content to insert."
                  },
                  "target": {
                    "type": "string",
                    "description": "move only: MDOM selector of destination reference node."
                  },
                  "match": {
                    "type": "string",
                    "enum": ["first", "all"],
                    "description": "remove only: remove first match (default) or all matches."
                  },
                  "find": {
                    "type": "string",
                    "description": "substitute only: text (or regex) to find."
                  },
                  "replace": {
                    "type": "string",
                    "description": "substitute only: replacement text."
                  },
                  "mode": {
                    "type": "string",
                    "enum": ["literal", "regex"],
                    "description": "substitute only: literal (default) or regex."
                  },
                  "count": {
                    "type": "string",
                    "enum": ["first", "all"],
                    "description": "substitute only: replace first (default) or all occurrences within scope."
                  }
                }
              }
            },
            "atomic": {
              "type": "boolean",
              "description": "Default true: roll back all ops if any op fails. If false, apply successful ops even if later ops fail."
            },
            "headerFormat": {
              "type": "string",
              "enum": ["hash", "dot"],
              "description": "Output header notation: hash (## Heading, default) or dot (h2. Heading)."
            },
            "stylePolicy": {
              "type": "string",
              "enum": ["preserve", "normalize"],
              "description": "preserve (default) keeps original spacing/fences/bullets; normalize applies consistent formatting."
            }
          },
          "required": ["markdown", "ops"]
        }
      }
    },
    "markdown_tasks": {
      "type": "function",
      "function": {
        "name": "markdown_tasks",
        "description": "Read and manage task items (checkboxes) in a Markdown document. Use this for all task state changes (do not use markdown_edit). mode controls behavior: query (read), update (set status), toggle (flip open/complete), add (insert new tasks), remove (delete tasks).\n\nSelector must follow MDOM syntax; prefer selectors from markdown_outline(format='json') or markdown_find.",
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "markdown": {
              "type": "string",
              "description": "The Markdown document containing the task list."
            },
            "mode": {
              "type": "string",
              "enum": ["query", "update", "toggle", "add", "remove"],
              "description": "query: return matching tasks as JSON. update: set status. toggle: flip open ('')/complete ('x'). add: insert new open tasks. remove: delete tasks."
            },
            "selector": {
              "type": "string",
              "description": "MDOM selector scoping to a section/list/task-item (e.g. ## [Sprint Backlog], ## [Sprint Backlog] > list, ## [Sprint Backlog] > task-item:2). Omit for whole document. Aliases: list/ul|ol, list-item/li, task-item. Index with :n. Not supported: :has, :nth-of-type."
            },
            "filter": {
              "type": "string",
              "description": "Attribute filter for tasks. Examples: [status=\"\"] open, [status=\"x\"] complete, [status=\"~\"] in-progress. Combine with selector."
            },
            "include": {
              "type": "array",
              "items": { "type": "string" },
              "description": "query only: fields to return per task: status, text, selector, section. Default returns all."
            },
            "status": {
              "type": "string",
              "description": "update only: status to set. Use '' open, 'x' complete, or any single char (e.g. '~', '-', '?')."
            },
            "match": {
              "type": "string",
              "enum": ["first", "all"],
              "description": "update/toggle/remove: affect first match (default) or all matches."
            },
            "items": {
              "type": "array",
              "items": { "type": "string" },
              "description": "add only: task labels (plain text). Each becomes one open task-item."
            },
            "where": {
              "type": "string",
              "enum": ["first-child", "last-child", "before", "after"],
              "description": "add only: insert location. last-child appends (default); first-child prepends; before/after relative to first matched task-item."
            }
          },
          "required": ["markdown", "mode"]
        }
      }
    }
  }
}
